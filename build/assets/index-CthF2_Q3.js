import{j as m,u as I,q as h}from"./index-Dt0_14Pi.js";import{S as j}from"./index-DAyZiM2j.js";import{C as x}from"./colums-DPt1vHSj.js";import{g as C,h as D,i as _,j as y,t as g}from"./index-D16PKcxo.js";import{S as q}from"./sakura-table-bar-DzdMcMAP.js";import{R as v}from"./dialog-9RMWZNz0.js";const T=async(a=1,e)=>{try{const o={page:a,name:e};return await C.get({url:`${D.role.getRoleList}`,params:o})}catch(o){throw console.error("Product API error:",o),o}},F=async a=>{try{return await C.delete({url:`${D.role.deleteRole}/${a}`})}catch(e){throw console.error("Product API error:",e),e}},L=async({id:a,role:e})=>{try{return await C.put({url:`${D.role.updateRole}/${a}`,data:e})}catch(o){throw console.error("Product API error:",o),o}},N=async a=>{try{return await C.post({url:`${D.role.createRole}`,data:a})}catch(e){throw console.error("Product API error:",e),e}},E=()=>{const[a,e]=m.useState(1),[o,c]=m.useState(""),l=I(),i=_({queryKey:["role-list",a,o],queryFn:async()=>{try{const t=await T(a,o);return t&&t.code===200&&t.data?t.data:{roles:[],currentPage:1,size:10,totalCount:0,totalPages:1}}catch(t){console.error("API Error:",t)}},retry:3,staleTime:10*1e3,placeholderData:t=>t}),u=y({mutationFn:F,onSuccess:()=>{l.invalidateQueries({queryKey:["role-list"]}),g("删除用户成功",{description:`您在 ${new Date().toUTCString()} 删除了用户`,action:{label:"确认",onClick:()=>console.log("用户已经确认")}})},onError:t=>{g(`删除用户失败 ${t.message}`)}}),p=y({mutationFn:N,onSuccess:()=>{l.invalidateQueries({queryKey:["role-list"]}),g("创建用户成功",{description:`您在 ${new Date().toUTCString()} 创建了用户`,action:{label:"确认",onClick:()=>console.log("用户已经确认")}})},onError:t=>{g(`创建用户失败 ${t.message}`)}}),d=y({mutationFn:L,onSuccess:()=>{l.invalidateQueries({queryKey:["role-list"]}),g("更新用户成功",{description:`您在 ${new Date().toUTCString()} 更新了用户`,action:{label:"确认",onClick:()=>console.log("用户已经确认")}})},onError:t=>{g(`更新用户失败 ${t.message}`)}}),n={roles:[],currentPage:1,size:10,totalCount:0,totalPages:1},s=i.data||n;return{roleListData:s,isLoading:i.isLoading,setFilterName:c,filterName:o,error:i.error,pagination:{totalCount:Number(s.totalCount)||0,totalPages:Number(s.totalPages)||1,currentPage:Number(s.currentPage)||1,setPage:e,getPage:a},isFeching:i.isFetching,createRole:p,updateRole:d,deleteRole:u}},k=()=>{const{updateRole:a,deleteRole:e,createRole:o}=E(),[c,l]=m.useState(!1),[i,u]=m.useState(!1),[p,d]=m.useState(void 0),[n,s]=m.useState({}),t=()=>{const r=Object.keys(n).filter($=>n[$]);e.mutate(r),s({})},S=Object.keys(n).filter(r=>n[r]).length;return{handleCreate:r=>{o.mutate(r)},handleDelete:r=>{e.mutate([r])},handleEdit:r=>{a.mutate({id:r.id,role:r})},handleOpenEditDialog:r=>{d(r),u(!0)},handleCloseDialog:()=>{l(!1),u(!1),d(void 0)},handleOpenCreateDialog:()=>{l(!0)},handleDeleteSelected:t,setRowSelection:s,rowSelection:n,selectedCount:S,isCreateDialogOpen:c,isEditDialogOpen:i,editingItem:p}};function A(){const{roleListData:a,pagination:e,filterName:o,setFilterName:c}=E(),{handleCreate:l,handleEdit:i,handleDelete:u,handleOpenCreateDialog:p,handleOpenEditDialog:d,handleCloseDialog:n,handleDeleteSelected:s,rowSelection:t,selectedCount:S,setRowSelection:P,isCreateDialogOpen:R,isEditDialogOpen:b,editingItem:f}=k(),w=x({handleOpenEditDialog:d,handleDelete:u});return h.jsxs("div",{className:"container mx-auto",children:[h.jsx(q,{enableSearch:!0,enableCreate:!0,enableSelected:!0,searchValue:o,selectCount:S,onSearchChange:c,onOpenCreateDialog:p,onDeleteItems:s,searchPlaceholder:"搜索名称",createButtonText:"创建用户"}),h.jsx(j,{columns:w,data:a?.roles.sort((O,r)=>O.order-r.order)||[],serverPagination:e,rowSelection:t,enablePagination:!0,onRowSelectionChange:P}),h.jsx(v,{open:R||b,enableSelected:!0,updateItem:f,handleCreate:l,handleEdit:i,onClose:n})]})}const V=Object.freeze(Object.defineProperty({__proto__:null,default:A},Symbol.toStringTag,{value:"Module"}));export{V as _};
